/* Converging Light Animation Overlay */
.converging-light-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  overflow: hidden;
  z-index: 20; /* Above grid lines, below modal popups */
}

/* Shared styles for light streams and borders */
.light-element {
  position: absolute;
  background: linear-gradient(90deg, #29FFC6, #46A6FF, #B721FF, #46A6FF, #29FFC6);
  background-size: 200% 100%;
  animation: gradient-pan 3s linear infinite;
  border-radius: 2px;
  opacity: 0;
  will-change: transform, opacity;
}

@keyframes gradient-pan {
  0% { background-position: 200% 0; }
  100% { background-position: 0% 0; }
}

/* 1. Header Flash */
.header-flash {
  opacity: 0;
  animation: header-flash-anim 1.3s ease-out forwards;
}

@keyframes header-flash-anim {
  0% { opacity: 0; transform: scale(0.8); }
  9.2% { opacity: 0.26; transform: scale(1); } /* 120ms peak */
  15% { opacity: 0; }
  100% { opacity: 0; }
}

/* 2. Twin Travel */
.light-stream-y {
  width: 2px;
  animation: travel-y-anim 1.3s cubic-bezier(0.2, 0.6, 0.2, 1) forwards;
}
.light-stream-x {
  height: 2px;
  animation: travel-x-anim 1.3s cubic-bezier(0.2, 0.6, 0.2, 1) forwards;
}

@keyframes travel-y-anim {
  0%, 9.2% { opacity: 0; transform: scaleY(0); } /* Start at 120ms */
  12% { opacity: 0.16; }
  40% { opacity: 0.16; transform: scaleY(1); } /* Travel time: 480ms (120 -> 600) */
  41% { opacity: 0; }
  100% { opacity: 0; transform: scaleY(1); }
}
@keyframes travel-x-anim {
  0%, 9.2% { opacity: 0; transform: scaleX(0); } /* Start at 120ms */
  12% { opacity: 0.16; }
  40% { opacity: 0.16; transform: scaleX(1); } /* Travel time: 480ms (120 -> 600) */
  41% { opacity: 0; }
  100% { opacity: 0; transform: scaleX(1); }
}

/* 3 & 4. Convergence, Wrap & Bloom */
.cell-border-wrap {
  border: 2px solid transparent;
  border-radius: 14px; /* Match cell rounding */
  animation: border-wrap-and-bloom-anim 1.3s ease-out forwards;
}

@keyframes border-wrap-and-bloom-anim {
  0%, 40% { opacity: 0; } /* Start at 600ms */
  40.1% { opacity: 1; }
  /* Wrap phase (200ms) + Bloom peak (250ms) */
  58% { /* 850ms */
    border-color: rgba(70, 166, 255, 0.30);
    box-shadow: 0 0 12px 4px rgba(70, 166, 255, 0.2),
                inset 0 0 6px 2px rgba(183, 33, 255, 0.18);
  }
  /* Settle phase */
  100% {
    opacity: 0;
    border-color: rgba(70, 166, 255, 0);
    box-shadow: 0 0 0px 0px rgba(70, 166, 255, 0),
                inset 0 0 0px 0px rgba(183, 33, 255, 0);
  }
}

/* Accessibility: Reduced Motion */
@media (prefers-reduced-motion: reduce) {
  .light-stream-y, .light-stream-x {
    animation: none; /* No travel */
  }
  .header-flash {
    animation: header-flash-reduced-anim 1s ease-out forwards;
  }
  .cell-border-wrap {
    animation: border-bloom-reduced-anim 1s ease-out forwards;
  }

  @keyframes header-flash-reduced-anim {
    0% { opacity: 0; }
    12% { opacity: 0.26; } /* 120ms flash */
    25% { opacity: 0; }
    100% { opacity: 0; }
  }

  @keyframes border-bloom-reduced-anim {
    0%, 12% { opacity: 0; } /* Start after header flash */
    12.1% { opacity: 1; }
    37% { /* Bloom for 250ms */
      border-color: rgba(70, 166, 255, 0.30);
      box-shadow: 0 0 12px 4px rgba(70, 166, 255, 0.2);
    }
    100% {
      opacity: 0;
      border-color: rgba(70, 166, 255, 0);
      box-shadow: 0 0 0px 0px rgba(70, 166, 255, 0);
    }
  }
}
